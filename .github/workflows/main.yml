name: CI

on: workflow_dispatch
  
jobs:
  run_atom_with_rigel:
    name: Testing ATOM with Rigel

    runs-on: ubuntu-20.04

    steps:
      
      - uses: actions/checkout@v3

      - name: Install Rigel and clone ATOM repo
        run: sudo apt update && cd ~/ && pip install git+https://github.com/rigel-ros/rigel@develop && cd ~/ && git clone --branch updated_atom https://github.com/Kazadhum/atom

      - name: Fix OpenSSL
        run: sudo apt-get install -y python3-pip && sudo dpkg -r --force-depends python3-openssl python3-cryptography && sudo pip3 install pyopenssl cryptography && sudo apt-get install -y --fix-missing python3-openssl python3-cryptography

      - name: Install my File Introspection Plugin
        run: sudo apt install python3-pip && pip install git+https://github.com/Kazadhum/file_intro_plugin@flow

      # - name: Install Xvfb
      #   run: sudo apt-get install -y xvfb

      # - name: Start Xvfb
      #   run: Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

      # - name: Set display variable
      #   run: export DISPLAY=:99

      - name: Test RRBot Calibration
        run: cd ~/atom/ && export DISPLAY=:99 && rigel run job compose && ls
        env:
          DISPLAY: :99
